<html>

    <head>
        <title>
            Resident Evil 2 - The Board Game Setup Helper
        </title>
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
        <link rel='stylesheet' href='grid.css'>
        <style>
            .normal {
                background-color: lightgrey;
            }

            .caution {
                background: repeating-linear-gradient(
                                45deg,
                                #FFF650,
                                #FFF650 10px,
                                lightgrey 10px,
                                lightgrey 20px
                            );
            }

            .danger {
                background: repeating-linear-gradient(
                                45deg,
                                #CC3620,
                                #CC3620 10px,
                                lightgrey 10px,
                                lightgrey 20px
                            );
            }

            .wall-top {
                border-top: 5px solid black;
            }

            .wall-right {
                border-right: 5px solid black;
            }

            .wall-bottom {
                border-bottom: 5px solid black;
            }

            .wall-left {
                border-left: 5px solid black;
            }

            .door-top {
                border-top: 5px solid green;
            }

            .door-right {
                border-right: 5px solid green;
            }

            .door-bottom {
                border-bottom: 5px solid green;
            }

            .door-left {
                border-left: 5px solid green;
            }

        </style>
    </head>

    <body>
        <div class="grid-container">
            <div class='grid'></div>
        </div>
        <label for="scenarioSelect">Select a Scenario</label>
        <select name="scenarioSelect" id="scenarioSelect">
            <option value="1">Scenario 1</option>
            <option value="2">Scenario 2</option>
        </select>
    </body>

    <script src="./room-defs.js"></script>
    <script>
        (function() {
            var grid = document.querySelector('.grid');
            for(var col = 25; col > 0; col--) {
                for (var row = 20; row > 0; row--) {
                    var div = document.createElement('div');
                    div.id = 'cell_' + col + 'x' + row;
                    div.classList.add('grid-cell');
                    grid.appendChild(div);
                }
            }
        })();

        var scenarioDefs = {
            [2]: {
                items: {
                    'a': [
                        'Handgun Bullets',
                        'Handgun Bullets',
                        'Handgun Bullets',
                        'Green Herb',
                        'Green Herb',
                        'Spade Key',
                    ],
                    'b': [
                        'Blowgun',
                        'Red Herb',
                        'S.T.A.R.S. Key'
                    ]
                },
                floors: {
                    [1]: {
                        isStartingFloor: {
                            '1p': true,
                            '2p': true
                        },
                        rooms: [
                            RoomGenerator[RoomDefs.SmallTall](12, 8, RoomTypes.Danger, [
                                {
                                    index: 0,
                                    config: {
                                        doors: [{
                                            direction: Directions.Left,
                                            connectingRoomIndex: 1
                                        }]
                                    }
                                },
                                {
                                    index: 1,
                                    config: {
                                        p1StartingPoint: true
                                    }
                                }
                            ]),
                            RoomGenerator[RoomDefs.SmallSquare](10, 8, RoomTypes.Normal, [
                                {
                                    index: 1,
                                    config: {
                                        doors: [{
                                            direction: Directions.Left,
                                            connectingRoomIndex: 0
                                        }],
                                        walls: [Directions.Top]
                                    }
                                },
                                {
                                    index: 2,
                                    config: {
                                        doors: [{
                                            direction: Directions.Left,
                                            connectingRoomIndex: 2
                                        }],
                                        walls: [Directions.Bottom, Directions.Right]
                                    }
                                }
                            ])
                        ]
                    }
                }
            }
        }

        function buildRoom(rooms, index) {
            var config = rooms[index];
            config.tiles.forEach(tileConfig => {
                var cell = document.querySelector('#cell_' + tileConfig.position.x + 'x' + tileConfig.position.y);
                cell.classList.add(config.type);

                if (tileConfig.walls) {
                    tileConfig.walls.forEach(wallDirection => {
                        cell.classList.add('wall-' + wallDirection);
                    });
                }

                if (tileConfig.doors) {
                    tileConfig.doors.forEach(door => {
                        cell.classList.add('door-' + door.direction);
                        cell.addEventListener('click', () => {
                            buildRoom(rooms, door.connectingRoomIndex);
                        });
                    });
                }
            })
        }

        // Add rectangle tile
        // add tile description
        // add tile requirements
        // add locked doors
        // add enemy markers
        // add stairs
        // add tension deck requirements
        // add description
        // add special rules
        // add encounter dice tables
        // add additional cards and tokens
        // add item randomizer
        // add starting items
        // add proper colours: green, yellow, amber
        console.log(RoomTypes);
        console.log(scenarioDefs[2]);
        buildRoom(scenarioDefs[2].floors[1].rooms, 0);
    </script>

</html>
